import React, { useEffect, useRef, useState } from 'react';
import { Link, useLocation } from 'react-router-dom';
//import classNames from 'classnames';
import './Header.css';
import logo from '../../assets/img/logo.svg';
import HeaderNav from './HeaderNav.tsx';
import { MAIN_NAV } from '../../constants/nav.ts';
import CatalogPanel from './CatalogPanel.tsx';

const Header: React.FC = () => {
  const [isCatalogOpen, setIsCatalogOpen] = useState(false);
  const { pathname } = useLocation();
  const buttonRef = useRef<HTMLButtonElement | null>(null);

  const handleCloseCatalog = () => setIsCatalogOpen(false);
  const handleToggleCatalog = () => setIsCatalogOpen((prev) => !prev);

  // close panel when pathname changed
  useEffect(() => {
    setIsCatalogOpen(false)
  }, [pathname])

  useEffect(() => {
    if (!isCatalogOpen) return;

    const onKey = (e: KeyboardEvent) => {
      if (e.key === 'Escape') {
        handleCloseCatalog();
      }
     }
     document.addEventListener('keydown', onKey);

    return () => document.removeEventListener('keydown', onKey)
  }, [isCatalogOpen])

    return (
      <header className="header">
        <div className="header__top bg-black">
          <div className="container">
            <div className="header__top-row d-flex justify-content-between align-items-end align-items-lg-center">
              <div className="d-flex align-items-center gap-1">
                <p className="color-white text-2">Ваш регион:</p>
                <p className="color-white text-2">Москва</p>
              </div>

              <div className="d-flex gap-4 align-items-center">
                <div className="d-flex align-items-center gap-1">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                    <path d="M20.5114 3.49206C27.1091 10.0919 23.8674 21.5596 14.8267 23.6686C5.45308 25.8554 -2.59587 16.7978 0.787392 7.75037C3.81723 -0.35364 14.3673 -2.653 20.5114 3.49206ZM11.0572 1.42433C4.43783 1.98698 -0.0235031 8.61122 1.84202 14.9935C4.17534 22.9766 14.5679 25.2703 20.0295 18.9339C26.2439 11.7236 20.5076 0.621616 11.0572 1.42433Z"
                          fill="white" />
                    <path d="M8.46511 10.4126C8.27294 10.724 9.09696 11.9946 9.31163 12.3031C10.0503 13.3647 12.0518 15.2289 13.3249 15.5121C13.8845 15.6368 13.953 14.9532 14.3082 14.5228C15.5485 13.0233 16.9481 13.4266 18.0599 14.8041C18.6486 15.5337 18.7986 16.3289 18.2399 17.1438C17.2022 18.6573 15.7857 18.602 14.1676 18.2288C10.0503 17.2779 6.38304 13.645 5.58714 9.46363C5.28434 7.87228 5.50371 7.15865 6.71302 6.08212C7.32049 5.54104 7.94483 5.34692 8.73041 5.66294C9.09602 5.81017 10.0982 6.7451 10.3091 7.08457C11.2072 8.53151 9.78129 9.98127 8.46511 10.4126Z"
                          fill="white" />
                  </svg>
                  <a className="d-none d-md-block color-white text-2" href="tel:+74953670803">+7 495 367-08-03</a>
                </div>
                <a className="d-flex align-items-center gap-1" href="#callback">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                    <path d="M0.787109 7.75C3.81709 -0.354367 14.3683 -2.65406 20.5127 3.49121L20.5117 3.49219C26.2117 9.19396 24.5671 18.528 18.1846 22.3232C18.1836 22.327 18.1816 22.3302 18.1797 22.333C18.1732 22.3349 18.1666 22.336 18.1602 22.3379C17.1617 22.9287 16.0478 23.3848 14.8271 23.6699C5.45417 25.8557 -2.59624 16.7977 0.787109 7.75ZM20.3203 18.583C26.0602 11.3695 20.3575 0.633281 11.0576 1.42383C4.43822 1.98659 -0.0234073 8.61073 1.8418 14.9922C2.24677 16.3772 2.89468 17.5913 3.7168 18.6182C4.59805 16.8185 6.50813 15.4004 8.46094 15.3301C8.53498 15.5495 8.58067 15.772 8.70996 15.9717C9.83308 17.7085 15.0356 17.7451 15.6572 15.3125C17.6493 15.4804 19.454 16.8061 20.3203 18.583ZM7.18164 6.57617C7.93633 1.60869 15.9809 1.37984 16.8828 6.66992C16.9155 6.86473 16.8809 7.48187 16.918 7.52637C16.9358 7.54699 17.2457 7.6 17.4238 7.72363C18.1859 8.2534 18.1986 9.73489 17.8604 10.5059C17.5997 11.1004 17.2223 11.0218 16.8164 11.3369C15.8013 12.1255 15.7181 13.2688 14.9375 14.2393C12.1241 17.7372 8.38417 14.7976 7.80566 11.2969C6.98912 11.3878 6.20096 10.9433 6.05469 10.0928C5.92345 9.32574 5.94803 8.2057 6.64062 7.72266C6.81822 7.59924 7.12797 7.54713 7.14746 7.52637C7.18401 7.48512 7.15078 6.77912 7.18164 6.57617ZM14.7988 7.46973C12.984 8.3454 11.0495 8.26733 9.21875 7.48633C8.42001 8.2478 8.70124 9.46244 8.75 10.4434L8.18945 10.1621C8.27387 14.4495 12.9574 17.4859 15.2188 12.6016C14.3605 12.7481 11.9684 13.6084 11.2842 13.1143C10.7745 12.7457 11.0211 12.0431 11.6162 11.9492C12.2715 11.8461 12.6711 12.1231 13.0977 12.125C13.6274 12.1278 15.4587 11.5617 15.7324 11.0947H15.7314C15.8112 10.9576 15.9405 10.2511 15.875 10.1621L15.3145 10.4434C15.3585 9.46806 15.6632 8.16557 14.7988 7.46973ZM15.7822 6.69043C15.0172 2.66168 9.01348 2.76013 8.18848 6.7373L9.07812 5.75195C10.7272 4.23273 13.267 4.21497 14.9404 5.70605L15.7822 6.69141V6.69043Z"
                          fill="#FBBA00" />
                  </svg>
                  <span className="color-yellow text-2 d-none d-md-block">Заказать звонок</span>
                </a>
                <p className="color-white text-2 d-none d-md-block">ПН–ПТ 8.00–19.00</p>
              </div>
            </div>
          </div>
        </div>
        <div className="header__bottom bg-yellow">
          <div className="container">
            <div className="header__bottom-row d-flex justify-content-between align-items-center">
              <Link to={'/'} className="header__logo" aria-label="Delta in Rock">
                <img src={logo} width="156" height="70" alt="Delta in Rock" className="header__logo-img" />
              </Link>
              <HeaderNav items={MAIN_NAV} isOpen={isCatalogOpen} onClick={handleToggleCatalog} buttonRef={buttonRef} />
              <div className="header__actions d-flex align-items-center">
                <a className="header__action d-flex align-items-center gap-1 position-relative"
                   href="#basket"
                   aria-label="Корзина">
                  <svg className="header__action-ico"
                       xmlns="http://www.w3.org/2000/svg"
                       width="20"
                       height="18"
                       viewBox="0 0 20 18"
                       fill="none">
                    <path d="M1.31202 9.60265C1.08204 9.60265 0.85519 9.60425 0.627557 9.60265C0.248168 9.59945 0.0025423 9.35268 0.00176005 8.9673C-0.000586685 8.18774 -0.000586685 7.40737 0.00176005 6.62781C0.00332455 6.25525 0.250514 6.00447 0.617388 6.00287C1.23536 6.00047 1.85412 5.99806 2.47209 6.00528C2.60351 6.00688 2.6833 5.96121 2.76387 5.85786C4.2165 3.99347 5.67148 2.13149 7.12724 0.269505C7.3228 0.0195316 7.57625 -0.0581846 7.83517 0.0475735C8.07141 0.143717 8.24038 0.392889 8.19501 0.64767C8.16841 0.796693 8.09253 0.950523 7.99944 1.0699C6.75724 2.67149 5.50799 4.26668 4.26109 5.86426C4.23449 5.89872 4.21103 5.93557 4.1727 5.99085H15.8352C15.6451 5.74489 15.4707 5.51815 15.2939 5.29221C14.1886 3.8773 13.0825 2.46238 11.9772 1.04747C11.7261 0.726187 11.7378 0.368052 12.0069 0.141314C12.2838 -0.0918349 12.635 -0.0333474 12.8916 0.293541C14.3395 2.14431 15.7867 3.99587 17.2307 5.84984C17.316 5.95961 17.3997 6.00688 17.5389 6.00447C18.1444 5.99646 18.7498 6.00047 19.3545 6.00127C19.7589 6.00127 19.9983 6.24483 19.9991 6.65745C20.0007 7.41699 19.9999 8.17732 19.9991 8.93686C19.9991 9.36069 19.7613 9.59945 19.342 9.60105C19.1277 9.60105 18.9133 9.60105 18.6849 9.60105C18.4964 10.2773 18.3102 10.9463 18.1233 11.6153C17.5788 13.5638 17.0344 15.5123 16.4892 17.4608C16.3757 17.867 16.2013 18 15.7851 18C11.9255 18 8.06593 18 4.20633 18C3.80269 18 3.62434 17.8646 3.51404 17.4696C2.79985 14.9138 2.08566 12.358 1.37147 9.80215C1.35348 9.73885 1.33471 9.67636 1.3128 9.60025L1.31202 9.60265ZM15.4558 16.7934C16.1238 14.3986 16.7903 12.0086 17.4576 9.61707H2.54171C3.2121 12.0207 3.87779 14.4066 4.54426 16.7934H15.4558ZM18.8093 8.39845V7.21588H1.18921V8.39845H18.8093Z"
                          fill="#1D1D1B" />
                    <path d="M7.36192 14.9561C7.36114 15.3014 7.13585 15.5658 6.84564 15.5987C6.54839 15.6331 6.26678 15.4433 6.21124 15.1332C6.07122 14.3488 5.9484 13.562 5.81933 12.7753C5.7505 12.3562 5.67853 11.9372 5.61986 11.5158C5.5698 11.1561 5.77318 10.862 6.09234 10.8051C6.40915 10.749 6.70562 10.9598 6.76663 11.3163C6.93951 12.3242 7.09987 13.3337 7.26492 14.3432C7.30012 14.5595 7.33298 14.7759 7.36192 14.9553V14.9561Z"
                          fill="#1D1D1B" />
                    <path d="M14.4296 11.4717C14.3459 11.9933 14.2576 12.5509 14.1676 13.1077C14.0675 13.7303 13.9626 14.3528 13.8649 14.9753C13.7921 15.436 13.4714 15.6924 13.1014 15.5778C12.8088 15.4873 12.6399 15.2269 12.6892 14.8992C12.8088 14.1116 12.9403 13.3257 13.067 12.5389C13.128 12.1583 13.1867 11.7778 13.2492 11.398C13.3251 10.9373 13.6818 10.6921 14.0534 10.8412C14.2943 10.9381 14.4422 11.1696 14.4296 11.4717Z"
                          fill="#1D1D1B" />
                    <path d="M10.5852 13.2105C10.5852 13.7898 10.586 14.3698 10.5852 14.9491C10.5845 15.3337 10.3388 15.6029 9.99542 15.6013C9.6528 15.5989 9.41343 15.3305 9.41343 14.9411C9.41265 13.7818 9.41343 12.6224 9.41343 11.4631C9.41343 11.0729 9.65045 10.8045 9.99308 10.8013C10.3443 10.7981 10.5845 11.0689 10.5852 11.4711C10.586 12.0504 10.5852 12.6304 10.5852 13.2097V13.2105Z"
                          fill="#1D1D1B" />
                  </svg>
                  <span className="header__action-badge color-black comment">232</span>
                </a>
                <a className="header__action d-flex align-items-center gap-1 color-black text-2 position-relative"
                   href="#compare"
                   aria-label="Сравнить">

                  <svg className="header__action-ico"
                       xmlns="http://www.w3.org/2000/svg"
                       width="20"
                       height="16"
                       viewBox="0 0 20 16"
                       fill="none">
                    <path d="M0 1.21452C0 0.54376 0.557608 0 1.24545 0H18.6818C19.3696 0 19.9272 0.54376 19.9272 1.21452C19.9272 1.88528 19.3696 2.42904 18.6818 2.42904H1.24545C0.557608 2.42904 0 1.88528 0 1.21452Z"
                          fill="#1D1D1B" />
                    <path d="M0 6.86418C0 6.19341 0.557608 5.64965 1.24545 5.64965H11.7241C12.412 5.64965 12.9696 6.19341 12.9696 6.86418C12.9696 7.53494 12.412 8.0787 11.7241 8.0787H1.24545C0.557608 8.0787 0 7.53494 0 6.86418Z"
                          fill="#1D1D1B" />
                    <path d="M0 12.4711C0 11.8004 0.557608 11.2566 1.24545 11.2566H5.2309C5.91875 11.2566 6.47635 11.8004 6.47635 12.4711C6.47635 13.1419 5.91875 13.6856 5.2309 13.6856H1.24545C0.557608 13.6856 0 13.1419 0 12.4711Z"
                          fill="#1D1D1B" />
                    <path d="M7.33926 10.3208C7.82564 9.84647 8.61422 9.84647 9.1006 10.3208L12.7983 13.9267C13.2847 14.401 13.2847 15.17 12.7983 15.6443C12.3119 16.1186 11.5234 16.1186 11.037 15.6443L7.33926 12.0384C6.85288 11.5641 6.85288 10.7951 7.33926 10.3208Z"
                          fill="#1D1D1B" />
                    <path d="M19.6352 7.37245C20.1216 7.84675 20.1216 8.61574 19.6352 9.09004L12.9141 15.6443C12.4277 16.1186 11.6391 16.1186 11.1527 15.6443C10.6663 15.17 10.6663 14.401 11.1527 13.9267L17.8739 7.37245C18.3603 6.89815 19.1488 6.89815 19.6352 7.37245Z"
                          fill="#1D1D1B" />
                  </svg>
                  <span className="header__action-badge color-black comment">234</span>
                </a>
                <button className="header__search btn-reset d-flex align-items-center gap-1">
                  <svg className="header__search-ico"
                       xmlns="http://www.w3.org/2000/svg"
                       width="20"
                       height="20"
                       viewBox="0 0 20 20"
                       fill="none">
                    <g clip-path="url(#clip0_651_1290)">
                      <path d="M6.95938 0.0719229C14.0469 -0.830994 18.7213 7.23133 14.4304 12.9045L19.76 18.322C20.1995 18.9692 19.9758 19.4886 19.3845 19.8961C18.8731 20.1678 18.4975 19.8802 18.09 19.5925C17.243 18.9932 13.2638 14.4387 12.8963 14.4307C6.41603 19.2489 -2.34146 12.7287 0.583028 5.07392C1.56585 2.48503 4.21067 0.423501 6.95938 0.0719229ZM14.0788 8.04635C14.0788 4.71435 11.3781 2.0056 8.03808 2.0056C4.69809 2.0056 1.99733 4.70636 1.99733 8.04635C1.99733 11.3863 4.69809 14.0871 8.03808 14.0871C11.3781 14.0871 14.0788 11.3863 14.0788 8.04635Z"
                            fill="#1D1D1B" />
                    </g>
                    <defs>
                      <clipPath id="clip0_651_1290">
                        <rect width="20" height="20" fill="white" />
                      </clipPath>
                    </defs>
                  </svg>

                  <span className="color-black text-2 d-none d-md-block">Поиск</span>
                </button>
                <button className="header__burger btn-reset d-flex d-xl-none" data-burger>
                  <svg xmlns="http://www.w3.org/2000/svg" width="30" height="31" viewBox="0 0 30 31" fill="none">
                    <path d="M28.125 26.6084C29.1603 26.6084 29.9996 27.4795 30 28.5537C30 29.6282 29.1605 30.5 28.125 30.5H1.875C0.839466 30.5 0 29.6282 0 28.5537C0.000413294 27.4795 0.839721 26.6084 1.875 26.6084H28.125ZM28.125 18.8262C29.1603 18.8262 29.9997 19.6972 30 20.7715C30 21.846 29.1605 22.7178 28.125 22.7178H1.875C0.839466 22.7178 0 21.846 0 20.7715C0.000315495 19.6972 0.839661 18.8262 1.875 18.8262H28.125ZM28.125 11.0439C29.1604 11.0439 29.9998 11.9149 30 12.9893C30 14.0638 29.1605 14.9355 28.125 14.9355H1.875C0.839466 14.9355 0 14.0638 0 12.9893C0.000217434 11.9149 0.8396 11.0439 1.875 11.0439H28.125ZM28.125 3.5C29.1604 3.5 29.9998 4.37096 30 5.44531C30 6.51985 29.1605 7.3916 28.125 7.3916H1.875C0.839466 7.3916 0 6.51985 0 5.44531C0.000207751 4.37096 0.839594 3.5 1.875 3.5H28.125Z"
                          fill="#1D1D1B" />
                    <circle cx="24" cy="3.25488" r="3" fill="white" />
                  </svg>
                </button>
              </div>
            </div>
          </div>
        </div>

        {isCatalogOpen && <CatalogPanel buttonRef={buttonRef} isOpen={isCatalogOpen} handleCloseCatalog={handleCloseCatalog} />}
      </header>
    );
};

export default Header;
